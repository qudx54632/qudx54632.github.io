<!-- 调整加载顺序 -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="{{ base_path }}/assets/js/main.min.js"></script>
{% include analytics.html %}

<script>
// 添加安全初始化逻辑
function initParticles() {
    try {
        if(window.particlesJS && document.getElementById('particles-js')) {
            particlesJS('particles-js', { /* 原有配置 */ });
            
            // 添加窗口resize监听
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    if(window.pJSDom && window.pJSDom.length > 0) {
                        window.pJSDom[0].pJS.fn.vendors.destroy();
                        window.pJSDom[0].pJS.fn.vendors.init();
                    }
                }, 200);
            });
        } else {
            console.error('ParticlesJS dependency missing or container not found');
        }
    } catch (e) {
        console.error('Particles initialization failed:', e);
    }
}

// 双保险加载机制
if(document.readyState === 'complete') {
    initParticles();
} else {
    document.addEventListener('DOMContentLoaded', initParticles);
}
</script>